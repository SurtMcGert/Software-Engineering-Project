{% extends 'base.html' %} {% block page %} {% load static %}

<h2>chat</h2>
{% for message in messages %}
<p>{{ message.user.username }} says: {{ message.content }}</p>
{% endfor %}

<form action="/chat" method="post">
    <input type="text" name="message" />
    <input type="submit" value="Send" />
</form>

<div id="user-hello"></div>
{{ aid|json_script:'discussionID' }}
<script>
    const discussionID = JSON.parse(document.getElementById("discussionID").textContent);
    wsURL = "ws://" + window.location.host + "/ws/discussion/" + discussionID + "/";
    console.log("connecting to:   " + wsURL);
    const chatSocket = new WebSocket(wsURL);

    chatSocket.onmessage = function (e) {
        const data = JSON.parse(e.data);
        document.querySelector("#user-hello").innerHTML = data.tester;
    };
</script>

{% endblock page %}
